name: Release Preview

on:
  workflow_call:
    inputs:
      build:
        required: false
        type: string
        default: nr build

      compact:
        required: false
        type: boolean
        default: false

      packages:
        required: false
        type: string
        default: ""

      comment-package-manager:
        required: false
        type: string
        default: ""

jobs:
  release:
    name: Release Preview
    runs-on: ubuntu-latest
    steps:
      - name: Setup repo
        uses: nicksp/workflows/.github/actions/setup-repo@2cc347bf0b61e9faedf8d3d8ba5d37d434123abb
      - name: Build
        run: ${{ inputs.build }}
      - name: Publish
        run: pnpm dlx pkg-pr-new publish --pnpm ${{ inputs.compact && '--compact' || '' }} ${{ inputs['comment-package-manager'] && format('--packageManager={0}', inputs['comment-package-manager']) || '' }} ${{ inputs.packages }}
